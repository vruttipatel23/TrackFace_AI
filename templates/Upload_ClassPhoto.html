{% extends "base.html" %}

{% block title %}Take Attendance | FaceTrack AI{% endblock %}

{% block content %}
<main class="container">
    <div class="glass-box form-wide">
        <header class="section-header enhanced-header">
            <div class="header-icon-wrapper">
                <i class="fa-solid fa-camera-retro"></i>
            </div>
            <div class="header-content">
                <h2>Take <span>Attendance</span></h2>
                <p>Upload class photos to automatically mark attendance using AI</p>
            </div>
        </header>

        <form id="attendanceForm" action="/process-classphoto" method="POST" enctype="multipart/form-data">
            <div class="form-grid enhanced-form-grid">
                <div class="input-group enhanced-input-group">
                    <label><i class="fa-solid fa-book"></i> Select Subject</label>
                    <div class="input-wrapper">
                        <select name="subject" required>
                            {% for sub in subjects %}
                            <option value="{{ sub }}">{{ sub }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="input-group enhanced-input-group">
                    <label><i class="fa-solid fa-calendar-days"></i> Class Date</label>
                    <div class="input-wrapper">
                        <input type="date" name="date" value="{{ today }}" required>
                    </div>
                </div>

                <div class="input-group enhanced-input-group">
                    <label><i class="fa-solid fa-layer-group"></i> Year</label>    
                        <select name="year" required>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                        </select>
                </div>

                <div class="input-group enhanced-input-group">
                    <label><i class="fa-solid fa-list-ol"></i> Semester</label>
                    <div class="input-wrapper">
                        <select name="semester" required>
                            {% for i in range(1, 9) %}<option value="{{ i }}">{{ i }}</option>{% endfor %}
                        </select>
                    </div>
                </div>

                <div class="full-width">
                    <label class="multi-upload-box enhanced-upload-box" for="classPhotos">
                        <input type="file" id="classPhotos" name="class_photos" multiple accept="image/*" hidden required>
                        <div class="upload-icon-wrapper">
                            <i class="fa-solid fa-cloud-arrow-up"></i>
                        </div>
                        <p id="uploadStatus" class="upload-text">Click to upload class photos</p>
                        <span class="upload-hint">Supports multiple images (JPG, PNG, etc.)</span>
                    </label>
                    <div id="classPreviewGrid" class="preview-grid"></div>
                </div>

                <button type="submit" id="processBtn" class="submit-btn enhanced-submit-btn">
                    <i class="fa-solid fa-microchip"></i> 
                    <span>Start AI Recognition</span>
                    
                </button>
            </div>
        </form>
        
        <footer class="form-footer">
            <a href="/faculty-dashboard" class="back-link"><i class="fa-solid fa-arrow-left"></i>Back to Dashboard</a>
        </footer>
    </div>
</main>
{% endblock %}

{% block scripts %}
<script>
    const input = document.getElementById('classPhotos');
    const status = document.getElementById('uploadStatus');
    const grid = document.getElementById('classPreviewGrid');

    input.addEventListener('change', function() {
        grid.innerHTML = '';
        const files = Array.from(this.files);
        status.innerText = files.length + " Photos Selected";

        files.forEach(file => {
            const reader = new FileReader();
            reader.onload = e => {
                const img = document.createElement('img');
                img.src = e.target.result;
                img.className = 'preview-thumb';
                grid.appendChild(img);
            }
            reader.readAsDataURL(file);
        });
    });

    document.getElementById('attendanceForm').onsubmit = function() {
        const btn = document.getElementById('processBtn');
        btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Processing... Please Wait';
        btn.disabled = true;
        btn.classList.add('processing');
    };
</script>
{% endblock %}