{% extends "base.html" %}

{% block title %}Take Attendance | FaceTrack AI{% endblock %}

{% block content %}
<main class="container">
    <div class="glass-box form-wide">
        <header class="section-header">
            <h2>Take <span>Attendance</span></h2>
            <p>Upload class photos</p>
        </header>

        <form id="attendanceForm" action="/process-classphoto" method="POST" enctype="multipart/form-data">
            <div class="form-grid">
                <div class="input-group">
                    <label>Select Subject</label>
                    <select name="subject" required>
                        {% for sub in subjects %}
                        <option value="{{ sub }}">{{ sub }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="input-group">
                    <label>Class Date</label>
                    <input type="date" name="date" value="{{ today }}" required>
                </div>

                <div class="input-group">
                    <label>Year</label>
                    <select name="year" required>
                        <option value="1">1st Year</option>
                        <option value="2">2nd Year</option>
                        <option value="3">3rd Year</option>
                        <option value="4">4th Year</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>Semester</label>
                    <select name="semester" required>
                        {% for i in range(1, 9) %}<option value="{{ i }}">{{ i }}</option>{% endfor %}
                    </select>
                </div>

                <div class="full-width">
                    <label class="multi-upload-box" for="classPhotos">
                        <input type="file" id="classPhotos" name="class_photos" multiple accept="image/*" hidden required>
                        <i class="fa-solid fa-images"></i>
                        <p id="uploadStatus">Click to upload class photos</p>
                    </label>
                    <div id="classPreviewGrid" class="preview-grid"></div>
                </div>

                <button type="submit" id="processBtn" class="submit-btn">
                    <i class="fa-solid fa-microchip"></i> Start AI Recognition
                </button>
            </div>
        </form>
        
        <footer class="form-footer">
            <a href="/faculty-dashboard" class="back-link">Back to Dashboard</a>
        </footer>
    </div>
</main>
{% endblock %}

{% block scripts %}
<script>
    const input = document.getElementById('classPhotos');
    const status = document.getElementById('uploadStatus');
    const grid = document.getElementById('classPreviewGrid');

    input.addEventListener('change', function() {
        grid.innerHTML = '';
        const files = Array.from(this.files);
        status.innerText = files.length + " Photos Selected";

        files.forEach(file => {
            const reader = new FileReader();
            reader.onload = e => {
                const img = document.createElement('img');
                img.src = e.target.result;
                img.className = 'preview-thumb';
                grid.appendChild(img);
            }
            reader.readAsDataURL(file);
        });
    });

    document.getElementById('attendanceForm').onsubmit = function() {
        const btn = document.getElementById('processBtn');
        btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Processing... Please Wait';
        btn.disabled = true;
        btn.classList.add('processing');
    };
</script>
{% endblock %}