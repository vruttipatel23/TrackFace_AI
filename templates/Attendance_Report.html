{% extends "base.html" %}

{% block title %}Attendance Report | FaceTrack AI{% endblock %}

{% block content %}
<main class="container">
    <div class="glass-box report-card">
        <header class="section-header-split">
            <div>
                <h2><i class="fa-solid fa-chart-line"></i> {{ subject }} - Semester Report</h2>
                <p>
                    <i class="fa-solid fa-graduation-cap"></i> Year {{ year }} | 
                    <i class="fa-solid fa-book"></i> Semester {{ semester }}
                </p>
            </div>

            <div class="header-actions">
                <a href="{{ url_for('download_report', subject=subject, year=year, semester=semester) }}" 
                    class="btn btn-success btn-small">
                    <i class="fa-solid fa-file-csv"></i> Download CSV
                </a>
                <a href="/faculty-dashboard" class="action-card btn-small">
                    <i class="fa-solid fa-check"></i> Done
                </a>
            </div>
        </header>

        <div class="table-responsive">
            <table class="history-table">
                <thead>
                    <tr>
                        <th>Enrollment No</th>
                        <th>Student Name</th>
                        {% for session in sessions %}
                            <th class="text-center">
                                <a href="{{ url_for('daily_report', session_id=session.id) }}" class="date-link">
                                    {{ session.date }}
                                </a>
                            </th>
                        {% endfor %}
                        <th class="text-center">Attendance %</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in table_data %}
                    <tr>
                        <td><strong>{{ row.enrollment_no }}</strong></td>
                        <td>{{ row.student_name }}</td>
                        {% for status in row.attendance %}
                        <td class="text-center">
                            <span class="status-tag {{ 'tag-present' if status == 'Present' else 'tag-absent' if status == 'Absent' else '' }}">
                                {{ 'P' if status == 'Present' else 'A' if status == 'Absent' else '-' }}
                            </span>
                        </td>
                        {% endfor %}
                        <td class="text-center">
                            <div class="percentage-badge"><strong>{{ row.percentage }}%</strong></div>
                            <div class="progress-container">
                                <div class="progress-bar" style="width: {{ row.percentage }}%;"></div>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</main>
{% endblock %}
